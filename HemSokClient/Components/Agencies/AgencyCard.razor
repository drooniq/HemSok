@inject IAPIService APIService
@inject IAuthStateService AuthStateService
@inject INavigationStateService NavigationStateService

<style>
    .card {
        width: 36rem;
        height: 22rem;
        margin: 1rem;
        box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.8);
        border: 1px solid black;
        transition: 0.3s ease;
        color: black;
        font-family: Arial, Helvetica, sans-serif;
        background-color: rgba(255, 255, 255, 0.5);
        border-radius: 15px;
    }

    .card:hover {
        transform: translateY(-15px);
        box-shadow: 0 16px 32px 0 rgba(0, 0, 0, 0.6);
    }

    .card-body {
        padding: 0.5rem;
    }

    .card-footer {
        background-color: rgba(200,200,200,0.7);
        padding: 0.5rem;
        display: flex;
        justify-content: right;
        align-items: right;
    }

    .card-footer-image {
        max-height: 2rem;
        max-width: 4rem;
        display: inline;
    }

    .left-footer {
        padding: 0px;
        flex: 1;
    }

    .right-footer {
        padding: 0px;
        max-width: 4rem;
    }

    .card-title {
        padding: 0px;
        margin: 0px;
        display: flex;
    }

    .card-title-left, .card-title-left h5 {
        display: flex;
        justify-content: center;
        align-items: center;
        flex: 1;
        font-size: xx-large;
        font-weight: 800;
        padding: 5px;
    }

    .card-title-right {
        max-width: 10rem;
    }

    .card-title-right img {
        border-radius: 10px;
    }
    
    .card-text h3, h4, h5 {
        margin: 0px;
        padding: 0px;
    }

    .card-text p {
        font-size: 1.2rem;
    }

    .card-text a {
        color: darkblue;
    }

    .card-text a:hover {
        color: lightblue;
    }

    .card-footer a {
        margin-left: 5px;
    }

</style>

@if(agency != null)
{
    <div class="card">
        <div class="card-img-container">
        </div>
        <div class="card-body">
            <div class="card-title">
                <div class="card-title-left">
                    <h5>
                        @agency.Name
                    </h5>
                </div>
                <div class="card-title-right">
                    <h5>
                        <img src="@agency.ImagePath" alt="..." class="card-img-top" />
                    </h5>
                </div>
            </div>
            <div class="card-text">
                <h3 style="text-align: center; font-weight: 900; margin: 0; padding: 0;">
                    @agency.PhoneNumber
                </h3>
                <h4 style="font-size: 1rem;text-align: center;">
                    <a style="text-decoration: none;"><i class="fa-solid fa-globe"></i> @agency.Website</a>
                </h4>
                <h4 style="font-size: 1rem;text-align: center;">
                    <a style="text-decoration: none;" href="mailto: @agency.Email"><i class="fa-regular fa-envelope"></i>  @agency.Email</a>
                </h4>
                <p>
                    @agency.Description
                </p>
            </div>
        </div>
            <div class="card-footer">
                @if (AuthStateService.IsSuperAdmin() || AuthStateService.IsAdmin())
                {
                    <a class="btn btn-primary" @onclick="@(e => NavigateToPage("/agencyedit/" + agency.Id))">Edit</a>
                }

                <a class="btn btn-secondary" @onclick="@(e => NavigateToPage("/agencydetails/" + agency.Id))">Details</a>

                @if (AuthStateService.IsSuperAdmin())
                {
                    <a class="btn btn-danger" @onclick="@(e => NavigateToPage("/agencydelete/" + agency.Id))">Delete</a>
                }
            </div>
    </div>
}
else
{
    @if(AuthStateService.currentUser == null)
    {
        StateHasChanged();
    }
}


@code {
    [Parameter]
    public int AgencyId { get; set; }

    private Agency? agency;
    private Agent? agent;

    protected override async Task OnInitializedAsync()
    {
        agency = await APIService.GetFromApiAsync<Agency>("/api/agency/" + AgencyId);
        GetAgent();
    }

    private async Task GetAgent()
    {
        agent = await APIService.GetFromApiAsync<Agent>("/api/agent/" + AuthStateService.currentUser?.AgentId);
    }

    private bool IsValidAdmin()
    {
        return (agent?.Agency.Id == AgencyId);
    }

    private void NavigateToPage(string page)
    {
        NavigationStateService.NavigateTo(page);
    }
}